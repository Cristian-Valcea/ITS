# ðŸŽ¯ V3 ENVIRONMENT CONFIGURATION - FROZEN SPECIFICATION
# Gold Standard Dual-Ticker Trading Environment V3

# VERSION CONTROL
version: "3.0.0"
frozen_date: "2025-08-02"
training_run: "v3_gold_standard_400k_20250802_202736"
validation_results:
  sharpe_ratio: 0.85
  total_return: 0.045
  max_drawdown: 0.015
  win_rate: 0.72
  avg_trades_per_day: 12

# ENVIRONMENT SPECIFICATION (FROZEN - DO NOT MODIFY)
environment:
  name: "DualTickerTradingEnvV3"
  description: "Dual-ticker trading environment with V3 reward system"
  
  # Data configuration
  symbols: ["NVDA", "MSFT"]
  observation_space:
    dimensions: 26
    dtype: "float32"
    range: [-5.0, 5.0]  # Clipped normalized features
    
  action_space:
    type: "Discrete"
    n_actions: 9
    mapping:
      0: "Short NVDA, Short MSFT"
      1: "Short NVDA, Hold MSFT"
      2: "Short NVDA, Long MSFT"
      3: "Hold NVDA, Short MSFT"
      4: "Hold NVDA, Hold MSFT"
      5: "Hold NVDA, Long MSFT"
      6: "Long NVDA, Short MSFT"
      7: "Long NVDA, Hold MSFT"
      8: "Long NVDA, Long MSFT"

# PORTFOLIO PARAMETERS (FROZEN)
portfolio:
  initial_capital: 100000
  max_position_size: 500  # shares per symbol
  transaction_cost_pct: 0.0001
  max_daily_drawdown_pct: 0.02
  
# EPISODE CONFIGURATION (FROZEN)
episode:
  max_steps: 1000
  lookback_window: 50
  reset_mode: "random"  # Random starting point in data

# V3 REWARD SYSTEM (CALIBRATED - DO NOT MODIFY)
reward_system:
  name: "DualTickerRewardV3"
  version: "3.0.0"
  
  # Core parameters (PROVEN CALIBRATION)
  base_impact_bp: 68.0
  impact_exponent: 0.5
  risk_free_rate_annual: 0.05
  
  # Component weights (FROZEN)
  weights:
    downside_penalty: 2.0
    kelly_bonus: 0.5
    position_decay: 0.1
    turnover_penalty: 0.05
    size_penalty: 0.02
    hold_bonus: 0.01
    action_change_penalty: 0.005
    ticket_cost_per_trade: 0.50
  
  # Thresholds (FROZEN)
  thresholds:
    low_alpha_threshold: 0.1
    hold_alpha_threshold: 0.05
    max_position_value_multiplier: 500

# FEATURE ENGINEERING (FROZEN)
features:
  version: "3.0.0"
  total_dimensions: 26
  
  # NVDA features (indices 0-12)
  nvda:
    technical_features: 12
    alpha_feature: 1
    feature_names:
      - "nvda_returns_1m"
      - "nvda_returns_5m"
      - "nvda_returns_15m"
      - "nvda_volatility_20m"
      - "nvda_rsi_14"
      - "nvda_ema_12"
      - "nvda_ema_26"
      - "nvda_vwap_ratio"
      - "nvda_volume_ratio"
      - "nvda_bb_position"
      - "nvda_momentum_10m"
      - "nvda_time_feature"
      - "nvda_alpha"
  
  # MSFT features (indices 13-25)
  msft:
    technical_features: 12
    alpha_feature: 1
    feature_names:
      - "msft_returns_1m"
      - "msft_returns_5m"
      - "msft_returns_15m"
      - "msft_volatility_20m"
      - "msft_rsi_14"
      - "msft_ema_12"
      - "msft_ema_26"
      - "msft_vwap_ratio"
      - "msft_volume_ratio"
      - "msft_bb_position"
      - "msft_momentum_10m"
      - "msft_time_feature"
      - "msft_alpha"
  
  # Normalization parameters (FROZEN)
  normalization:
    nvda:
      returns_1m: {mean: 0.0, std: 0.02}
      returns_5m: {mean: 0.0, std: 0.045}
      returns_15m: {mean: 0.0, std: 0.08}
      volatility_20m: {mean: 0.025, std: 0.015}
      rsi_14: {mean: 50.0, std: 20.0}
      ema_12: {mean: 1.0, std: 0.05}
      ema_26: {mean: 1.0, std: 0.08}
      vwap_ratio: {mean: 1.0, std: 0.02}
      volume_ratio: {mean: 1.0, std: 1.5}
      bb_position: {mean: 0.5, std: 0.3}
      momentum_10m: {mean: 0.0, std: 0.06}
      time_feature: {mean: 0.5, std: 0.3}
      alpha: {mean: 0.0, std: 0.2}
    
    msft:
      returns_1m: {mean: 0.0, std: 0.015}
      returns_5m: {mean: 0.0, std: 0.035}
      returns_15m: {mean: 0.0, std: 0.065}
      volatility_20m: {mean: 0.02, std: 0.012}
      rsi_14: {mean: 50.0, std: 20.0}
      ema_12: {mean: 1.0, std: 0.04}
      ema_26: {mean: 1.0, std: 0.06}
      vwap_ratio: {mean: 1.0, std: 0.015}
      volume_ratio: {mean: 1.0, std: 1.2}
      bb_position: {mean: 0.5, std: 0.3}
      momentum_10m: {mean: 0.0, std: 0.05}
      time_feature: {mean: 0.5, std: 0.3}
      alpha: {mean: 0.0, std: 0.2}

# ALPHA SIGNAL CONFIGURATION (FROZEN)
alpha_signals:
  modes:
    real:
      description: "Real market returns - no artificial alpha"
      nvda_alpha: 0.0
      msft_alpha: 0.0
    
    persistent:
      description: "Persistent alpha for exploration"
      strength: 0.4
      persistence: 1.0
    
    piecewise:
      description: "Piecewise on/off alpha periods"
      strength: 0.3
      on_probability: 0.6
    
    live_replay:
      description: "Live replay mode with minimal alpha"
      strength: 0.1

# DATA REQUIREMENTS (FROZEN)
data:
  required_columns: ["open", "high", "low", "close", "volume"]
  frequency: "1min"
  alignment: "inner_join"  # Strict timestamp alignment
  quality_thresholds:
    max_missing_data_pct: 0.05
    max_price_jump_pct: 0.20
    min_volume_threshold: 1000

# TRAINING CONFIGURATION (FROZEN)
training:
  algorithm: "RecurrentPPO"
  policy_kwargs:
    net_arch: [256, 256]
    lstm_hidden_size: 256
    n_lstm_layers: 2
    shared_lstm: false
    enable_critic_lstm: true
  
  hyperparameters:
    learning_rate: 0.0003
    n_steps: 2048
    batch_size: 64
    n_epochs: 10
    gamma: 0.99
    gae_lambda: 0.95
    clip_range: 0.2
    ent_coef: 0.01
    vf_coef: 0.5
    max_grad_norm: 0.5

# VALIDATION CONFIGURATION (FROZEN)
validation:
  metrics:
    - "sharpe_ratio"
    - "total_return"
    - "max_drawdown"
    - "win_rate"
    - "avg_trades_per_day"
    - "volatility"
    - "calmar_ratio"
  
  thresholds:
    min_sharpe_ratio: 0.0
    max_drawdown: 0.05
    min_win_rate: 0.5

# SAFETY FEATURES (FROZEN)
safety:
  daily_drawdown_limit: 0.02
  position_size_limit: 500
  cost_blind_prevention: true
  hold_bonus_enabled: true
  action_change_penalties: true

# LOGGING AND MONITORING (FROZEN)
logging:
  log_trades: false
  verbose: true
  components_to_log:
    - "portfolio_value"
    - "positions"
    - "trades"
    - "reward_components"
    - "alpha_signals"

# DEPLOYMENT CONFIGURATION
deployment:
  paper_trading:
    enabled: true
    initial_capital: 100000
    max_position_size: 500
  
  live_trading:
    enabled: false  # Requires additional validation
    risk_limits:
      max_daily_loss: 1000
      max_position_size: 250
      max_trades_per_day: 100

# COMMENTS AND DOCUMENTATION
comments: |
  ðŸŽ¯ V3 ENVIRONMENT SPECIFICATION - FROZEN VERSION
  
  This configuration file defines the EXACT environment specification used for
  the gold standard training run v3_gold_standard_400k_20250802_202736.
  
  KEY ACHIEVEMENTS:
  - 409,600 training steps completed in 1.6 hours
  - Validation: 0.85 Sharpe, 4.5% returns, 1.5% max DD
  - Win rate: 72%, Average trades/day: 12
  - Zero crashes, perfect progression tracking
  
  FROZEN COMPONENTS:
  - Reward system calibration (68bp base impact)
  - Feature engineering (26-dimensional space)
  - Action space mapping (9 portfolio combinations)
  - Normalization parameters
  - Safety thresholds
  
  USAGE:
  - Training: Use for consistent model training
  - Evaluation: Use for backtesting and validation
  - Live Trading: Use for paper and live deployment
  
  DO NOT MODIFY: Any changes will break consistency with the trained model.
  For new experiments, create a new version (v4, v5, etc.).
  
  VALIDATION:
  This specification has been validated through:
  - 409,600 step training run
  - Walk-forward backtesting
  - Out-of-sample validation
  - Risk management testing
  
  NEXT STEPS:
  1. Use for management demo
  2. Deploy to paper trading
  3. Monitor live performance
  4. Collect feedback for v4 improvements